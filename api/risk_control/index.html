
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../decision/base/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Controller Module - Risk control for scikit-learn</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../sg_gallery-rendered-html.css">
    
      <link rel="stylesheet" href="../../sg_gallery-dataframe.css">
    
      <link rel="stylesheet" href="../../sg_gallery-binder.css">
    
      <link rel="stylesheet" href="../../sg_gallery.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#risk_control" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Risk control for scikit-learn" class="md-header__button md-logo" aria-label="Risk control for scikit-learn" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Risk control for scikit-learn
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Controller Module
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../generated/gallery/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Risk control for scikit-learn" class="md-nav__button md-logo" aria-label="Risk control for scikit-learn" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Risk control for scikit-learn
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Controller Module
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Controller Module
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#risk_control--risk-control-for-conformal-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Risk control for conformal prediction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#risk_control.RiskController" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RiskController
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RiskController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController--which-control-method-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      Which control method to use?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController--which-pvalues-methods-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      Which pvalues methods to use?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController--which-fwer-method-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      Which FWER method to use?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._valid_pvalues_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_valid_pvalues_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._valid_fwer_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_valid_fwer_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._valid_control_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_valid_control_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.decision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;decision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.params" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.risks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;risks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.target_risks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;target_risks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.delta" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;delta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.pvalue_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;pvalue_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.fwer_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;fwer_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.control_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;control_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.cr_results" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;cr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.ref_risk" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ref_risk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.ref_param" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ref_param
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.lambda_to_select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;lambda_to_select
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._initialize_cr_results" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_initialize_cr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._clone_decision_with_params" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_clone_decision_with_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._get_all_combinations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_get_all_combinations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._estimate_risk" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_estimate_risk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._estimate_pvalues" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_estimate_pvalues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._control_fwer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_control_fwer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.test" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.control" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.fit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.predict" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.summary" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Decision Module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Decision Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decision/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decision/regression/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regression Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decision/classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Classification Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decision/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples of Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Risk Module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Risk Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../risk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Risk Based
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Parameter Module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Parameter Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parameter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameter Module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/pvalues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P-Values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/fwer_control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FWER Control
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../generated/gallery/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/gallery/plot_classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Selective Classification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/gallery/plot_classification_bis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Selective Classification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/gallery/plot_regression/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Selective Regression
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/gallery/plot_precision_recall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Precision-Recall Trade-off for Binary Classification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/gallery/plot_ai_assistance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Selective (Binary) Classification for Human-AI Collaboration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#risk_control--risk-control-for-conformal-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Risk control for conformal prediction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#risk_control.RiskController" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RiskController
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RiskController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController--which-control-method-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      Which control method to use?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController--which-pvalues-methods-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      Which pvalues methods to use?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController--which-fwer-method-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      Which FWER method to use?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._valid_pvalues_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_valid_pvalues_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._valid_fwer_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_valid_fwer_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._valid_control_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_valid_control_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.decision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;decision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.params" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.risks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;risks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.target_risks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;target_risks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.delta" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;delta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.pvalue_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;pvalue_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.fwer_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;fwer_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.control_method" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;control_method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.cr_results" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;cr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.ref_risk" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ref_risk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.ref_param" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ref_param
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.lambda_to_select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;lambda_to_select
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._initialize_cr_results" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_initialize_cr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._clone_decision_with_params" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_clone_decision_with_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._get_all_combinations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_get_all_combinations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._estimate_risk" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_estimate_risk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._estimate_pvalues" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_estimate_pvalues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController._control_fwer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_control_fwer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.test" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.control" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.fit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.predict" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risk_control.RiskController.summary" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div class="doc doc-object doc-module">



<h1 id="risk_control" class="doc doc-heading">
            Controller Module


</h1>

    <div class="doc doc-contents first">

        <h2 id="risk_control--risk-control-for-conformal-prediction">Risk control for conformal prediction</h2>
<p>This module contains the class <code>RiskController</code> which is used to control the
risk of conformal prediction.</p>








<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="RiskController (risk_control.RiskController)" href="#risk_control.RiskController">RiskController</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Risk control for conformal prediction.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="risk_control.RiskController" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">RiskController</span>


</h2>


    <div class="doc doc-contents ">


        <p>Risk control for conformal prediction.</p>
<h3 id="risk_control.RiskController--which-control-method-to-use">Which control method to use?</h3>
<p>The control method consists in choosing a lambda value that controls the risk
(defined by the user) at a given level (also defined by the user).
Based on multiple testing, the control method gives a set of lambda values
that control the risk. But the user has to choose one of them. And the
strategy to choose depends on the type of risk and the type of decision.
Here are the different strategies:</p>
<ul>
<li>"lmin" : smallest lambda for which the risk is acceptable</li>
<li>"lmax" : largest lambda for which the risk is acceptable</li>
<li>"rmin" : optimal lambda for which the risk is minimized
and acceptable</li>
<li>"rmax" : optimal lambda for which the risk is maximized
and acceptable</li>
</ul>
<h3 id="risk_control.RiskController--which-pvalues-methods-to-use">Which pvalues methods to use?</h3>
<p>The pvalues method consists in computing p-values for each lambda value.
These p-values are used to control the risk. The possible methods to
compute p-values are:</p>
<ul>
<li>"clt" : Central Limit Theorem, which is a normal approximation of the
distribution of the risk.</li>
<li>"hb" : Hoeffding-Bentkus Inequality, which is a concentration inequality
for the distribution of the risk.</li>
</ul>
<h3 id="risk_control.RiskController--which-fwer-method-to-use">Which FWER method to use?</h3>
<p>The FWER method (for Family-Wise Error Rate) is used to control the risk
for multiple testing. Why? Because we have a set of lambda values, and we
want to control the risk for all of them. They are possible methods:</p>
<ul>
<li>"bonferroni" : Bonferroni Correction, which is a simple but conservative
method that divides the significance level by the number of comparisons.</li>
<li>"sgt" : Sequential Graphical Testing (SGT), which is a more powerful method
than Bonferroni Correction because it takes into account the space of
hypothesis via a directed graph. The procedure sequentially tests the hypotheses
at iteratively updayed significance levels.</li>
</ul>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="decision


  
      instance-attribute
   (risk_control.RiskController.decision)" href="#risk_control.RiskController.decision">decision</a></code></td>
            <td>
                  <code><span title="risk_control.decision.BaseDecision">BaseDecision</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The decision to be made.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="params


  
      instance-attribute
   (risk_control.RiskController.params)" href="#risk_control.RiskController.params">params</a></code></td>
            <td>
                  <code><span title="risk_control.parameter.BaseParameterSpace">BaseParameterSpace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameter space of the decision.
(The possible values of the lambda values).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="risks


  
      instance-attribute
   (risk_control.RiskController.risks)" href="#risk_control.RiskController.risks">risks</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <span title="risk_control.risk.BaseRisk">BaseRisk</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The risks to be controlled.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="delta


  
      instance-attribute
   (risk_control.RiskController.delta)" href="#risk_control.RiskController.delta">delta</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired error rate (see family-wise error rate method).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="pvalue_method


  
      instance-attribute
   (risk_control.RiskController.pvalue_method)" href="#risk_control.RiskController.pvalue_method">pvalue_method</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to estimate the p-values.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="fwer_method


  
      instance-attribute
   (risk_control.RiskController.fwer_method)" href="#risk_control.RiskController.fwer_method">fwer_method</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to control the family-wise error rate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="control_method


  
      instance-attribute
   (risk_control.RiskController.control_method)" href="#risk_control.RiskController.control_method">control_method</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to choose the lambda value to control the risk.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="risk_control.RiskController._n_samples">_n_samples</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of samples.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="risk_control.RiskController.l_values">l_values</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3.13/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of lambda values (flattened parameter space).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="cr_results


  
      instance-attribute
   (risk_control.RiskController.cr_results)" href="#risk_control.RiskController.cr_results">cr_results</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the risk values for each lambda value.
The dictionary has the following structure:</p>
<ul>
<li>f"risks.{key}.values": list of risk values for each lambda value.
    (for each lambda value in rows and each sample in columns)</li>
<li>f"risks.{key}.mean": list of mean risk values for each lambda value.</li>
<li>f"risks.{key}.std": list of standard deviation of risk values for each lambda value.</li>
<li>f"risks.{key}.pvalue": list of p-values for each lambda value.</li>
<li>"params": list of all parameters for each lambda value.</li>
<li>f"params.{key}" Additional keys for each parameter in the parameter space.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="risk_control.RiskController.valid_lambdas">valid_lambdas</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The valid lambda values (for which the p-value is less than alpha).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="risk_control.RiskController.valid_risks">valid_risks</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The valid risk values (for which the p-value is less than alpha)
(keys are the risk names).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="risk_control.RiskController.l_star">l_star</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimal lambda value (optimizing the risk).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="risk_control.RiskController.r_star">r_star</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimal risk value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="risk_control.RiskController.has_solution">has_solution</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether a solution exists.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="_valid_pvalues_method


  
      class-attribute
      instance-attribute
   (risk_control.RiskController._valid_pvalues_method)" href="#risk_control.RiskController._valid_pvalues_method">_valid_pvalues_method</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The valid p-values methods.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="_valid_fwer_method


  
      class-attribute
      instance-attribute
   (risk_control.RiskController._valid_fwer_method)" href="#risk_control.RiskController._valid_fwer_method">_valid_fwer_method</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The valid FWER methods.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="_valid_control_method


  
      class-attribute
      instance-attribute
   (risk_control.RiskController._valid_control_method)" href="#risk_control.RiskController._valid_control_method">_valid_control_method</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The valid control methods (defining the criteria for selecting the optimal
lambda value).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>










<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="__init__ (risk_control.RiskController.__init__)" href="#risk_control.RiskController.__init__">__init__</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Initialize the RiskController class.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="evaluate (risk_control.RiskController.evaluate)" href="#risk_control.RiskController.evaluate">evaluate</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Evaluate, for all lambda values (i.e., the grid of the decision function),</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="test (risk_control.RiskController.test)" href="#risk_control.RiskController.test">test</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Test all hypotheses and identify valid lambda values that control the</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="control (risk_control.RiskController.control)" href="#risk_control.RiskController.control">control</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Control the risk based on the specified method. The procedure is as follows:</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit (risk_control.RiskController.fit)" href="#risk_control.RiskController.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Fit the decision model on the input data, i.e.:</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="predict (risk_control.RiskController.predict)" href="#risk_control.RiskController.predict">predict</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Make predictions on the input data.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="summary (risk_control.RiskController.summary)" href="#risk_control.RiskController.summary">summary</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Print a summary of the risk control results.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>



              <details class="quote">
                <summary>Source code in <code>risk_control/risk_control.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RiskController</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Risk control for conformal prediction.</span>

<span class="sd">    # Which control method to use?</span>
<span class="sd">    The control method consists in choosing a lambda value that controls the risk</span>
<span class="sd">    (defined by the user) at a given level (also defined by the user).</span>
<span class="sd">    Based on multiple testing, the control method gives a set of lambda values</span>
<span class="sd">    that control the risk. But the user has to choose one of them. And the</span>
<span class="sd">    strategy to choose depends on the type of risk and the type of decision.</span>
<span class="sd">    Here are the different strategies:</span>

<span class="sd">    - &quot;lmin&quot; : smallest lambda for which the risk is acceptable</span>
<span class="sd">    - &quot;lmax&quot; : largest lambda for which the risk is acceptable</span>
<span class="sd">    - &quot;rmin&quot; : optimal lambda for which the risk is minimized</span>
<span class="sd">    and acceptable</span>
<span class="sd">    - &quot;rmax&quot; : optimal lambda for which the risk is maximized</span>
<span class="sd">    and acceptable</span>

<span class="sd">    # Which pvalues methods to use?</span>
<span class="sd">    The pvalues method consists in computing p-values for each lambda value.</span>
<span class="sd">    These p-values are used to control the risk. The possible methods to</span>
<span class="sd">    compute p-values are:</span>

<span class="sd">    - &quot;clt&quot; : Central Limit Theorem, which is a normal approximation of the</span>
<span class="sd">    distribution of the risk.</span>
<span class="sd">    - &quot;hb&quot; : Hoeffding-Bentkus Inequality, which is a concentration inequality</span>
<span class="sd">    for the distribution of the risk.</span>

<span class="sd">    # Which FWER method to use?</span>
<span class="sd">    The FWER method (for Family-Wise Error Rate) is used to control the risk</span>
<span class="sd">    for multiple testing. Why? Because we have a set of lambda values, and we</span>
<span class="sd">    want to control the risk for all of them. They are possible methods:</span>

<span class="sd">    - &quot;bonferroni&quot; : Bonferroni Correction, which is a simple but conservative</span>
<span class="sd">    method that divides the significance level by the number of comparisons.</span>
<span class="sd">    - &quot;sgt&quot; : Sequential Graphical Testing (SGT), which is a more powerful method</span>
<span class="sd">    than Bonferroni Correction because it takes into account the space of</span>
<span class="sd">    hypothesis via a directed graph. The procedure sequentially tests the hypotheses</span>
<span class="sd">    at iteratively updayed significance levels.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    decision : BaseDecision</span>
<span class="sd">        The decision to be made.</span>
<span class="sd">    params: BaseParameterSpace</span>
<span class="sd">        The parameter space of the decision.</span>
<span class="sd">        (The possible values of the lambda values).</span>
<span class="sd">    risks : Dict[str, BaseRisk]</span>
<span class="sd">        The risks to be controlled.</span>
<span class="sd">    delta : float</span>
<span class="sd">        The desired error rate (see family-wise error rate method).</span>
<span class="sd">    pvalue_method : str</span>
<span class="sd">        The method to estimate the p-values.</span>
<span class="sd">    fwer_method : str</span>
<span class="sd">        The method to control the family-wise error rate.</span>
<span class="sd">    control_method : str</span>
<span class="sd">        The method to choose the lambda value to control the risk.</span>
<span class="sd">    _n_samples : int</span>
<span class="sd">        The number of samples.</span>
<span class="sd">    l_values : List[dict]</span>
<span class="sd">        The list of lambda values (flattened parameter space).</span>
<span class="sd">    cr_results : dict</span>
<span class="sd">        A dictionary containing the risk values for each lambda value.</span>
<span class="sd">        The dictionary has the following structure:</span>

<span class="sd">        - f&quot;risks.{key}.values&quot;: list of risk values for each lambda value.</span>
<span class="sd">            (for each lambda value in rows and each sample in columns)</span>
<span class="sd">        - f&quot;risks.{key}.mean&quot;: list of mean risk values for each lambda value.</span>
<span class="sd">        - f&quot;risks.{key}.std&quot;: list of standard deviation of risk values for each lambda value.</span>
<span class="sd">        - f&quot;risks.{key}.pvalue&quot;: list of p-values for each lambda value.</span>
<span class="sd">        - &quot;params&quot;: list of all parameters for each lambda value.</span>
<span class="sd">        - f&quot;params.{key}&quot; Additional keys for each parameter in the parameter space.</span>
<span class="sd">    valid_lambdas : np.ndarray</span>
<span class="sd">        The valid lambda values (for which the p-value is less than alpha).</span>
<span class="sd">    valid_risks : Dict[str, np.ndarray]</span>
<span class="sd">        The valid risk values (for which the p-value is less than alpha)</span>
<span class="sd">        (keys are the risk names).</span>
<span class="sd">    l_star : float</span>
<span class="sd">        The optimal lambda value (optimizing the risk).</span>
<span class="sd">    r_star : float</span>
<span class="sd">        The optimal risk value.</span>
<span class="sd">    has_solution : bool</span>
<span class="sd">        Whether a solution exists.</span>
<span class="sd">    _valid_pvalues_method : dict</span>
<span class="sd">        The valid p-values methods.</span>
<span class="sd">    _valid_fwer_method : dict</span>
<span class="sd">        The valid FWER methods.</span>
<span class="sd">    _valid_control_method : dict</span>
<span class="sd">        The valid control methods (defining the criteria for selecting the optimal</span>
<span class="sd">        lambda value).</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

    <span class="n">_valid_pvalues_method</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;clt&quot;</span><span class="p">:</span> <span class="n">compute_clt_p_values</span><span class="p">,</span>
        <span class="s2">&quot;hb&quot;</span><span class="p">:</span> <span class="n">compute_hb_p_values</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_valid_fwer_method</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># type: ignore</span>
        <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="n">fwer_bonferroni</span><span class="p">,</span>
        <span class="c1"># TODO: fixed sequence testing</span>
        <span class="s2">&quot;sgt_old&quot;</span><span class="p">:</span> <span class="n">fwer_sgt</span><span class="p">,</span>
        <span class="s2">&quot;sgt&quot;</span><span class="p">:</span> <span class="n">fwer_sgt_nd</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_valid_control_method</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># type: ignore</span>
        <span class="s2">&quot;lmin&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="p">[</span><span class="n">elt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_param</span><span class="p">]</span> <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span><span class="p">]</span>
        <span class="p">),</span>  <span class="c1"># TODO: not working because elements are dictionary</span>
        <span class="s2">&quot;lmax&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span>
            <span class="p">[</span><span class="n">elt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_param</span><span class="p">]</span> <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span><span class="p">]</span>
        <span class="p">),</span>  <span class="c1"># TODO: not working because elements are dictionary</span>
        <span class="s2">&quot;rmin&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_risk</span><span class="p">]),</span>
        <span class="s2">&quot;rmax&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_risk</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">decision</span><span class="p">:</span> <span class="n">BaseDecision</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">BaseParameterSpace</span><span class="p">,</span>
        <span class="n">risks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseRisk</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseRisk</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseRisk</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">pvalue_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;clt&quot;</span><span class="p">,</span>
        <span class="n">fwer_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sgt&quot;</span><span class="p">,</span>
        <span class="n">control_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rmin&quot;</span><span class="p">,</span>
        <span class="n">lambda_to_select</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the RiskController class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        decision : BaseDecision</span>
<span class="sd">            The decision object used for making predictions and decisions.</span>
<span class="sd">        params : BaseParameterSpace</span>
<span class="sd">            The parameter space for the risk control.</span>
<span class="sd">        risks : Union[BaseRisk, List[BaseRisk], Dict[str, BaseRisk]]</span>
<span class="sd">            The risk object used for computing risk values.</span>
<span class="sd">        delta : float</span>
<span class="sd">            The desired error rate.</span>
<span class="sd">        pvalue_method : str</span>
<span class="sd">            The method to use for p-value computation (&quot;clt&quot; or &quot;hb&quot;), by default &quot;hb&quot;.</span>
<span class="sd">        fwer_method : str</span>
<span class="sd">            The method to use for FWER control (&quot;standard&quot; or &quot;sgt&quot;), by default &quot;sgt&quot;.</span>
<span class="sd">        control_method : str</span>
<span class="sd">            The method to use for risk control (&quot;lmin&quot;, &quot;lmax&quot;, &quot;rmin&quot;, &quot;rmax&quot;).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AssertionError</span>
<span class="sd">            If `pvalue_method`, `fwer_method` or `control_method` is not valid.</span>
<span class="sd">        AssertionError</span>
<span class="sd">            If `delta` is not in the interval (0, 1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decision</span> <span class="o">=</span> <span class="n">decision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseRisk</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">risks</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">risks</span> <span class="o">=</span> <span class="p">{</span><span class="n">risk_</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">risk_</span> <span class="k">for</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="n">risks</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">risks</span><span class="p">,</span> <span class="n">BaseRisk</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">risks</span> <span class="o">=</span> <span class="p">{</span><span class="n">risks</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">risks</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">risks</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">risks</span> <span class="o">=</span> <span class="n">risks</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">risk_</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">risk_</span><span class="o">.</span><span class="n">acceptable_risk</span> <span class="k">for</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;delta must be in (0, 1)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>

        <span class="k">assert</span> <span class="n">pvalue_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_pvalues_method</span><span class="p">,</span> <span class="s2">&quot;Invalid pvalue_method&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pvalue_method</span> <span class="o">=</span> <span class="n">pvalue_method</span>

        <span class="k">assert</span> <span class="n">fwer_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_fwer_method</span><span class="p">,</span> <span class="s2">&quot;Invalid fwer_method&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwer_method</span> <span class="o">=</span> <span class="n">fwer_method</span>

        <span class="k">assert</span> <span class="n">control_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_control_method</span><span class="p">,</span> <span class="s2">&quot;Invalid control_method&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_method</span> <span class="o">=</span> <span class="n">control_method</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_cr_results</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_risk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_param</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_to_select</span> <span class="o">=</span> <span class="n">lambda_to_select</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_cr_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the control results dictionary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Union[List[Any], np.ndarray]]</span>
<span class="sd">            The initialized control results dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;risks.AGG.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;params.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">cr_results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clone_decision_with_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDecision</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clone the decision object with the given parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **params : dict</span>
<span class="sd">            The parameters to set on the cloned decision object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseDecision</span>
<span class="sd">            The cloned decision object with the given parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">decision_clone</span><span class="p">:</span> <span class="n">BaseDecision</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="p">)</span>
        <span class="c1"># TODO: clone(self.decision) # with scikit-learn</span>
        <span class="n">decision_clone</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">decision_clone</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_all_combinations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all combinations of parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : Dict[str, Any]</span>
<span class="sd">            The parameters and their possible values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[Dict[str, Any]]</span>
<span class="sd">            All combinations of parameters.</span>
<span class="sd">        Tuple[int]</span>
<span class="sd">            The shape of the combinations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">combinations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)]</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">combinations</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">shape</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_estimate_risk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">l_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the risk for each lambda value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : np.ndarray</span>
<span class="sd">            The input features.</span>
<span class="sd">        y : np.ndarray</span>
<span class="sd">            The true labels.</span>
<span class="sd">        l_values : List[Dict[str, Any]]</span>
<span class="sd">            The list of lambda values to evaluate.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional keyword arguments for risk computation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cr_results : Dict[str, Any]</span>
<span class="sd">            A dictionary containing the risk values for each lambda value.</span>
<span class="sd">            The dictionary has the following structure:</span>

<span class="sd">            - f&quot;risks.{key}.values&quot;: list of risk values for each lambda value.</span>
<span class="sd">                (for each lambda value in rows and each sample in columns)</span>
<span class="sd">            - f&quot;risks.{key}.mean&quot;: list of mean risk values for each lambda value.</span>
<span class="sd">            - f&quot;risks.{key}.std&quot;: list of standard deviation of risk values for each lambda value.</span>
<span class="sd">            - f&quot;risks.{key}.pvalue&quot;: list of p-values for each lambda value.</span>
<span class="sd">            - &quot;params&quot;: list of all parameters for each lambda value.</span>
<span class="sd">            - f&quot;params.{key}&quot; Additional keys for each parameter in the parameter space.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
        <span class="n">cr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_cr_results</span><span class="p">()</span>

        <span class="n">y_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="o">.</span><span class="n">make_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l_value</span> <span class="ow">in</span> <span class="n">l_values</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_to_select</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_to_select</span><span class="p">(</span><span class="n">l_value</span><span class="p">):</span>
                <span class="n">new_decision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clone_decision_with_params</span><span class="p">(</span><span class="o">**</span><span class="n">l_value</span><span class="p">)</span>
                <span class="n">y_decision</span> <span class="o">=</span> <span class="n">new_decision</span><span class="o">.</span><span class="n">make_decision</span><span class="p">(</span><span class="n">y_output</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">risks</span> <span class="o">=</span> <span class="n">risk_</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">y_decision</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">risks</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">risks</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">risks</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
                    <span class="p">)</span>
                    <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                    <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

            <span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l_value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">l_value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;params.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># convert lists to numpy arrays for easier manipulation</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">cr_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cr_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cr_results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate, for all lambda values (i.e., the grid of the decision function),</span>
<span class="sd">        the risk values and means for the given data with respect to the decision</span>
<span class="sd">        function and risk function.</span>

<span class="sd">        It sets the `cr_results` attribute with the results of the evaluation.</span>
<span class="sd">        Its a dictionary with the following structure:</span>

<span class="sd">        - &quot;values&quot;: list of risk values for each lambda value.</span>
<span class="sd">        - &quot;mean&quot;: list of mean risk values for each lambda value.</span>
<span class="sd">        - &quot;std&quot;: list of standard deviation of risk values for each lambda value.</span>
<span class="sd">        - Additional keys for each parameter in the parameter space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : np.ndarray</span>
<span class="sd">            The input features.</span>
<span class="sd">        y : np.ndarray</span>
<span class="sd">            The true labels.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional keyword arguments for risk estimation.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AssertionError</span>
<span class="sd">            If the number of samples in `X` and `y` do not match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">l_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_risk</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_estimate_pvalues</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate p-values for the risk values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : np.ndarray</span>
<span class="sd">            The risk values with shape (n_params, n_samples).</span>
<span class="sd">        alpha : float</span>
<span class="sd">            The desired risk value.</span>
<span class="sd">        method : str</span>
<span class="sd">            The method to use for p-value computation (&quot;clt&quot; or &quot;hb&quot;).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The computed p-values.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AssertionError</span>
<span class="sd">            If the method is not in the valid p-values methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_pvalues_method</span>
        <span class="n">p_values</span> <span class="o">=</span> <span class="n">RiskController</span><span class="o">.</span><span class="n">_valid_pvalues_method</span><span class="p">[</span><span class="n">method</span><span class="p">](</span>
            <span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span>
        <span class="p">)</span>
        <span class="n">p_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p_values</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_control_fwer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">p_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control the family-wise error rate (FWER).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p_values : np.ndarray</span>
<span class="sd">            The p-values with shape (n_params,).</span>
<span class="sd">        delta : float</span>
<span class="sd">            The desired error rate.</span>
<span class="sd">        method : str</span>
<span class="sd">            The method to use for FWER control (&quot;standard&quot; or &quot;sgt&quot;).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The sorted indices of valid hypotheses.</span>

<span class="sd">        Warns</span>
<span class="sd">        -----</span>
<span class="sd">        UserWarning</span>
<span class="sd">            If no valid hypotheses are found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">RiskController</span><span class="o">.</span><span class="n">_valid_fwer_method</span><span class="p">[</span><span class="n">method</span><span class="p">](</span>
            <span class="n">p_values</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;param_shape&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_shape</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No valid hypotheses.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test all hypotheses and identify valid lambda values that control the</span>
<span class="sd">        risk and family-wise error rate. The procedure is as follows:</span>

<span class="sd">        1. Estimate p-values for each lambda (with</span>
<span class="sd">        [`_estimate_pvalues`][risk_control.RiskController._estimate_pvalues]</span>
<span class="sd">        method).</span>
<span class="sd">        2. Control the family-wise error rate (with</span>
<span class="sd">        [`_control_fwer`][risk_control.RiskController._control_fwer] method).</span>
<span class="sd">        3. Store the valid lambda values (`valid_lambdas`)</span>
<span class="sd">        and their corresponding risks (`valid_risks`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_pvalues</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span><span class="p">[</span><span class="n">name_</span><span class="p">],</span>
                <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pvalue_method</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cr_specific_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_fwer</span><span class="p">(</span>
                <span class="n">p_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]),</span>
                <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwer_method</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cr_specific_results</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;valid_lambdas&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">],</span>
                    <span class="s2">&quot;valid_risks&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">],</span>
                    <span class="s2">&quot;p_values&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cr_specific_results</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;valid_lambdas&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;valid_risks&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;p_values&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">],</span>
                <span class="p">}</span>

        <span class="n">p_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="p">)</span>
        <span class="n">p_values</span> <span class="o">=</span> <span class="n">p_values</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;risks.AGG.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_values</span>

        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_fwer</span><span class="p">(</span>
            <span class="n">p_values</span><span class="o">=</span><span class="n">p_values</span><span class="p">,</span>
            <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwer_method</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_solution</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_solution</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control the risk based on the specified method. The procedure is as follows:</span>

<span class="sd">        1. Check if a solution exists (`has_solution`).</span>
<span class="sd">        2. If a solution exists, select the optimal lambda value (`l_star`) and</span>
<span class="sd">          corresponding risk (`r_star`) based on the control method.</span>
<span class="sd">        3. Set the parameters of the decision model to the optimal lambda value.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If no solution is found for risk control.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_solution</span><span class="p">:</span>
            <span class="c1"># raise ValueError(&quot;No solution found for risk control.&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">RiskController</span><span class="o">.</span><span class="n">_valid_control_method</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">control_method</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name_</span><span class="p">:</span> <span class="n">valid_risks_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">valid_risks_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the decision model on the input data, i.e.:</span>

<span class="sd">        1. Evaluate the decision model on the calibration data.</span>
<span class="sd">        2. Compute the p-values for the risk control.</span>
<span class="sd">        3. Find the valid lambdas for the risk control.</span>
<span class="sd">        4. Find the optimal lambda for the risk control.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : np.ndarray</span>
<span class="sd">            The input features.</span>
<span class="sd">        y : np.ndarray</span>
<span class="sd">            The target labels.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional keyword arguments to pass to the `evaluate` method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : RiskController</span>
<span class="sd">            The fitted risk control model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make predictions on the input data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : np.ndarray</span>
<span class="sd">            The input features.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The predicted labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a summary of the risk control results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== SUMMARY ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p(risk&lt;=alpha) &gt;= 1-delta&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1-delta: </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== risks ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">r_star</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">risk_</span><span class="o">.</span><span class="n">convert_to_performance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_star</span><span class="p">[</span><span class="n">name_</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">risk_</span><span class="o">.</span><span class="n">convert_to_performance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span><span class="p">[</span><span class="n">name_</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="se">\t</span><span class="s2">| optimal: </span><span class="si">{</span><span class="n">r_star</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\t</span><span class="s2">| alpha: </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== params ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">l_star</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="se">\t</span><span class="s2">| optimal: </span><span class="si">{</span><span class="n">l_star</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController._valid_pvalues_method" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_valid_pvalues_method</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_valid_pvalues_method</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;clt&quot;</span><span class="p">:</span> <span class="n"><span title="risk_control.tools.pvalues.compute_clt_p_values">compute_clt_p_values</span></span><span class="p">,</span>
    <span class="s2">&quot;hb&quot;</span><span class="p">:</span> <span class="n"><span title="risk_control.tools.pvalues.compute_hb_p_values">compute_hb_p_values</span></span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController._valid_fwer_method" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_valid_fwer_method</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_valid_fwer_method</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="n"><span title="risk_control.tools.fwer_control.fwer_bonferroni">fwer_bonferroni</span></span><span class="p">,</span>
    <span class="s2">&quot;sgt_old&quot;</span><span class="p">:</span> <span class="n"><span title="risk_control.tools.fwer_control.fwer_sgt">fwer_sgt</span></span><span class="p">,</span>
    <span class="s2">&quot;sgt&quot;</span><span class="p">:</span> <span class="n"><span title="risk_control.tools.fwer_control.fwer_sgt_nd">fwer_sgt_nd</span></span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController._valid_control_method" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_valid_control_method</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_valid_control_method</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;lmin&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="numpy.argmin" href="https://numpy.org/doc/stable/reference/generated/numpy.argmin.html#numpy.argmin">argmin</a></span><span class="p">(</span>
        <span class="p">[</span><span class="n"><span title="elt">elt</span></span><span class="p">[</span><span class="n"><span title="self.ref_param">ref_param</span></span><span class="p">]</span> <span class="k">for</span> <span class="n"><span title="elt">elt</span></span> <span class="ow">in</span> <span class="n"><span title="self.valid_lambdas">valid_lambdas</span></span><span class="p">]</span>
    <span class="p">),</span>
    <span class="s2">&quot;lmax&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="numpy.argmax" href="https://numpy.org/doc/stable/reference/generated/numpy.argmax.html#numpy.argmax">argmax</a></span><span class="p">(</span>
        <span class="p">[</span><span class="n"><span title="elt">elt</span></span><span class="p">[</span><span class="n"><span title="self.ref_param">ref_param</span></span><span class="p">]</span> <span class="k">for</span> <span class="n"><span title="elt">elt</span></span> <span class="ow">in</span> <span class="n"><span title="self.valid_lambdas">valid_lambdas</span></span><span class="p">]</span>
    <span class="p">),</span>
    <span class="s2">&quot;rmin&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="numpy.argmin" href="https://numpy.org/doc/stable/reference/generated/numpy.argmin.html#numpy.argmin">argmin</a></span><span class="p">(</span><span class="n"><span title="self.valid_risks">valid_risks</span></span><span class="p">[</span><span class="n"><span title="self.ref_risk">ref_risk</span></span><span class="p">]),</span>
    <span class="s2">&quot;rmax&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="numpy.argmax" href="https://numpy.org/doc/stable/reference/generated/numpy.argmax.html#numpy.argmax">argmax</a></span><span class="p">(</span><span class="n"><span title="self.valid_risks">valid_risks</span></span><span class="p">[</span><span class="n"><span title="self.ref_risk">ref_risk</span></span><span class="p">]),</span>
<span class="p">}</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.decision" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">decision</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">decision</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(decision)">decision</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.params" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">params</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">params</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(params)">params</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.risks" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">risks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">risks</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.target_risks" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">target_risks</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">target_risks</span> <span class="o">=</span> <span class="p">{</span><span class="n"><span title="risk_.name">name</span></span><span class="p">:</span> <span class="n">_j5npUk9PwgV7DMfor</span> <span class="n"><span title="risk_">risk_</span></span> <span class="ow">in</span> <span class="n"><span title="risk_control.RiskController(self).risks.values">values</span></span><span class="p">()}</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.delta" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">delta</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">delta</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(delta)">delta</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.pvalue_method" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">pvalue_method</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">pvalue_method</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(pvalue_method)">pvalue_method</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.fwer_method" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">fwer_method</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">fwer_method</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(fwer_method)">fwer_method</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.control_method" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">control_method</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">control_method</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(control_method)">control_method</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.cr_results" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">cr_results</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">cr_results</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(self)._initialize_cr_results">_initialize_cr_results</span></span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.ref_risk" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ref_risk</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ref_risk</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/glossary.html#term-list">list</a></span><span class="p">(</span><span class="n"><span title="risk_control.RiskController(self).risks.keys">keys</span></span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.ref_param" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ref_param</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ref_param</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/glossary.html#term-list">list</a></span><span class="p">(</span><span class="n"><span title="risk_control.RiskController(self).params.keys">keys</span></span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="risk_control.RiskController.lambda_to_select" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">lambda_to_select</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">lambda_to_select</span> <span class="o">=</span> <span class="n"><span title="risk_control.RiskController(lambda_to_select)">lambda_to_select</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">decision</span><span class="p">,</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">risks</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">delta</span><span class="p">,</span>
    <span class="n">pvalue_method</span><span class="o">=</span><span class="s2">&quot;clt&quot;</span><span class="p">,</span>
    <span class="n">fwer_method</span><span class="o">=</span><span class="s2">&quot;sgt&quot;</span><span class="p">,</span>
    <span class="n">control_method</span><span class="o">=</span><span class="s2">&quot;rmin&quot;</span><span class="p">,</span>
    <span class="n">lambda_to_select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>decision</code>
            </td>
            <td>
                  <code><span title="risk_control.decision.BaseDecision">BaseDecision</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The decision object used for making predictions and decisions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="risk_control.parameter.BaseParameterSpace">BaseParameterSpace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameter space for the risk control.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>risks</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3.13/library/typing.html#typing.Union">Union</a>[<span title="risk_control.risk.BaseRisk">BaseRisk</span>, <a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3.13/library/typing.html#typing.List">List</a>[<span title="risk_control.risk.BaseRisk">BaseRisk</span>], <a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <span title="risk_control.risk.BaseRisk">BaseRisk</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The risk object used for computing risk values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delta</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired error rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pvalue_method</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to use for p-value computation ("clt" or "hb"), by default "hb".</p>
              </div>
            </td>
            <td>
                  <code>&#39;clt&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fwer_method</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to use for FWER control ("standard" or "sgt"), by default "sgt".</p>
              </div>
            </td>
            <td>
                  <code>&#39;sgt&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>control_method</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to use for risk control ("lmin", "lmax", "rmin", "rmax").</p>
              </div>
            </td>
            <td>
                  <code>&#39;rmin&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/exceptions.html#AssertionError">AssertionError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>pvalue_method</code>, <code>fwer_method</code> or <code>control_method</code> is not valid.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/exceptions.html#AssertionError">AssertionError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>delta</code> is not in the interval (0, 1).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">decision</span><span class="p">:</span> <span class="n">BaseDecision</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">BaseParameterSpace</span><span class="p">,</span>
    <span class="n">risks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseRisk</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseRisk</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseRisk</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pvalue_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;clt&quot;</span><span class="p">,</span>
    <span class="n">fwer_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sgt&quot;</span><span class="p">,</span>
    <span class="n">control_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rmin&quot;</span><span class="p">,</span>
    <span class="n">lambda_to_select</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the RiskController class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    decision : BaseDecision</span>
<span class="sd">        The decision object used for making predictions and decisions.</span>
<span class="sd">    params : BaseParameterSpace</span>
<span class="sd">        The parameter space for the risk control.</span>
<span class="sd">    risks : Union[BaseRisk, List[BaseRisk], Dict[str, BaseRisk]]</span>
<span class="sd">        The risk object used for computing risk values.</span>
<span class="sd">    delta : float</span>
<span class="sd">        The desired error rate.</span>
<span class="sd">    pvalue_method : str</span>
<span class="sd">        The method to use for p-value computation (&quot;clt&quot; or &quot;hb&quot;), by default &quot;hb&quot;.</span>
<span class="sd">    fwer_method : str</span>
<span class="sd">        The method to use for FWER control (&quot;standard&quot; or &quot;sgt&quot;), by default &quot;sgt&quot;.</span>
<span class="sd">    control_method : str</span>
<span class="sd">        The method to use for risk control (&quot;lmin&quot;, &quot;lmax&quot;, &quot;rmin&quot;, &quot;rmax&quot;).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        If `pvalue_method`, `fwer_method` or `control_method` is not valid.</span>
<span class="sd">    AssertionError</span>
<span class="sd">        If `delta` is not in the interval (0, 1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decision</span> <span class="o">=</span> <span class="n">decision</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseRisk</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">risks</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">risks</span> <span class="o">=</span> <span class="p">{</span><span class="n">risk_</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">risk_</span> <span class="k">for</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="n">risks</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">risks</span><span class="p">,</span> <span class="n">BaseRisk</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">risks</span> <span class="o">=</span> <span class="p">{</span><span class="n">risks</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">risks</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">risks</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">risks</span> <span class="o">=</span> <span class="n">risks</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">risk_</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">risk_</span><span class="o">.</span><span class="n">acceptable_risk</span> <span class="k">for</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;delta must be in (0, 1)&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>

    <span class="k">assert</span> <span class="n">pvalue_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_pvalues_method</span><span class="p">,</span> <span class="s2">&quot;Invalid pvalue_method&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pvalue_method</span> <span class="o">=</span> <span class="n">pvalue_method</span>

    <span class="k">assert</span> <span class="n">fwer_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_fwer_method</span><span class="p">,</span> <span class="s2">&quot;Invalid fwer_method&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fwer_method</span> <span class="o">=</span> <span class="n">fwer_method</span>

    <span class="k">assert</span> <span class="n">control_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_control_method</span><span class="p">,</span> <span class="s2">&quot;Invalid control_method&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">control_method</span> <span class="o">=</span> <span class="n">control_method</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_cr_results</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ref_risk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ref_param</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lambda_to_select</span> <span class="o">=</span> <span class="n">lambda_to_select</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController._initialize_cr_results" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_initialize_cr_results</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_initialize_cr_results</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the control results dictionary.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3.13/library/typing.html#typing.Union">Union</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3.13/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3.13/library/typing.html#typing.Any">Any</a>], <a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initialized control results dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_initialize_cr_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the control results dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[str, Union[List[Any], np.ndarray]]</span>
<span class="sd">        The initialized control results dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;risks.AGG.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;params.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">cr_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController._clone_decision_with_params" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_clone_decision_with_params</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_clone_decision_with_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Clone the decision object with the given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters to set on the cloned decision object.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="risk_control.decision.BaseDecision">BaseDecision</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cloned decision object with the given parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_clone_decision_with_params</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDecision</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clone the decision object with the given parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **params : dict</span>
<span class="sd">        The parameters to set on the cloned decision object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BaseDecision</span>
<span class="sd">        The cloned decision object with the given parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">decision_clone</span><span class="p">:</span> <span class="n">BaseDecision</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="p">)</span>
    <span class="c1"># TODO: clone(self.decision) # with scikit-learn</span>
    <span class="n">decision_clone</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decision_clone</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController._get_all_combinations" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_get_all_combinations</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_get_all_combinations</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all combinations of parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3.13/library/typing.html#typing.Any">Any</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters and their possible values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3.13/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3.13/library/typing.html#typing.Any">Any</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All combinations of parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3.13/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#int">int</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shape of the combinations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_all_combinations</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all combinations of parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params : Dict[str, Any]</span>
<span class="sd">        The parameters and their possible values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[Dict[str, Any]]</span>
<span class="sd">        All combinations of parameters.</span>
<span class="sd">    Tuple[int]</span>
<span class="sd">        The shape of the combinations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">combinations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)]</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">combinations</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">shape</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController._estimate_risk" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_estimate_risk</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_estimate_risk</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">l_values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Estimate the risk for each lambda value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The true labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>l_values</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3.13/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3.13/library/typing.html#typing.Any">Any</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of lambda values to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for risk computation.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cr_results</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3.13/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3.13/library/typing.html#typing.Any">Any</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the risk values for each lambda value.
The dictionary has the following structure:</p>
<ul>
<li>f"risks.{key}.values": list of risk values for each lambda value.
    (for each lambda value in rows and each sample in columns)</li>
<li>f"risks.{key}.mean": list of mean risk values for each lambda value.</li>
<li>f"risks.{key}.std": list of standard deviation of risk values for each lambda value.</li>
<li>f"risks.{key}.pvalue": list of p-values for each lambda value.</li>
<li>"params": list of all parameters for each lambda value.</li>
<li>f"params.{key}" Additional keys for each parameter in the parameter space.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_estimate_risk</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">l_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate the risk for each lambda value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : np.ndarray</span>
<span class="sd">        The input features.</span>
<span class="sd">    y : np.ndarray</span>
<span class="sd">        The true labels.</span>
<span class="sd">    l_values : List[Dict[str, Any]]</span>
<span class="sd">        The list of lambda values to evaluate.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Additional keyword arguments for risk computation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cr_results : Dict[str, Any]</span>
<span class="sd">        A dictionary containing the risk values for each lambda value.</span>
<span class="sd">        The dictionary has the following structure:</span>

<span class="sd">        - f&quot;risks.{key}.values&quot;: list of risk values for each lambda value.</span>
<span class="sd">            (for each lambda value in rows and each sample in columns)</span>
<span class="sd">        - f&quot;risks.{key}.mean&quot;: list of mean risk values for each lambda value.</span>
<span class="sd">        - f&quot;risks.{key}.std&quot;: list of standard deviation of risk values for each lambda value.</span>
<span class="sd">        - f&quot;risks.{key}.pvalue&quot;: list of p-values for each lambda value.</span>
<span class="sd">        - &quot;params&quot;: list of all parameters for each lambda value.</span>
<span class="sd">        - f&quot;params.{key}&quot; Additional keys for each parameter in the parameter space.</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="n">cr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_cr_results</span><span class="p">()</span>

    <span class="n">y_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="o">.</span><span class="n">make_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l_value</span> <span class="ow">in</span> <span class="n">l_values</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_to_select</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_to_select</span><span class="p">(</span><span class="n">l_value</span><span class="p">):</span>
            <span class="n">new_decision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clone_decision_with_params</span><span class="p">(</span><span class="o">**</span><span class="n">l_value</span><span class="p">)</span>
            <span class="n">y_decision</span> <span class="o">=</span> <span class="n">new_decision</span><span class="o">.</span><span class="n">make_decision</span><span class="p">(</span><span class="n">y_output</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">risks</span> <span class="o">=</span> <span class="n">risk_</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">y_decision</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">risks</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">risks</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">risks</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
                <span class="p">)</span>
                <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l_value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">l_value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;params.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="c1"># convert lists to numpy arrays for easier manipulation</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">cr_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cr_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cr_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController.evaluate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">evaluate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Evaluate, for all lambda values (i.e., the grid of the decision function),
the risk values and means for the given data with respect to the decision
function and risk function.</p>
<p>It sets the <code>cr_results</code> attribute with the results of the evaluation.
Its a dictionary with the following structure:</p>
<ul>
<li>"values": list of risk values for each lambda value.</li>
<li>"mean": list of mean risk values for each lambda value.</li>
<li>"std": list of standard deviation of risk values for each lambda value.</li>
<li>Additional keys for each parameter in the parameter space.</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The true labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for risk estimation.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/exceptions.html#AssertionError">AssertionError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the number of samples in <code>X</code> and <code>y</code> do not match.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate, for all lambda values (i.e., the grid of the decision function),</span>
<span class="sd">    the risk values and means for the given data with respect to the decision</span>
<span class="sd">    function and risk function.</span>

<span class="sd">    It sets the `cr_results` attribute with the results of the evaluation.</span>
<span class="sd">    Its a dictionary with the following structure:</span>

<span class="sd">    - &quot;values&quot;: list of risk values for each lambda value.</span>
<span class="sd">    - &quot;mean&quot;: list of mean risk values for each lambda value.</span>
<span class="sd">    - &quot;std&quot;: list of standard deviation of risk values for each lambda value.</span>
<span class="sd">    - Additional keys for each parameter in the parameter space.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : np.ndarray</span>
<span class="sd">        The input features.</span>
<span class="sd">    y : np.ndarray</span>
<span class="sd">        The true labels.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Additional keyword arguments for risk estimation.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        If the number of samples in `X` and `y` do not match.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">l_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_risk</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController._estimate_pvalues" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_estimate_pvalues</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_estimate_pvalues</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Estimate p-values for the risk values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The risk values with shape (n_params, n_samples).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired risk value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to use for p-value computation ("clt" or "hb").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The computed p-values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/exceptions.html#AssertionError">AssertionError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the method is not in the valid p-values methods.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_estimate_pvalues</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate p-values for the risk values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values : np.ndarray</span>
<span class="sd">        The risk values with shape (n_params, n_samples).</span>
<span class="sd">    alpha : float</span>
<span class="sd">        The desired risk value.</span>
<span class="sd">    method : str</span>
<span class="sd">        The method to use for p-value computation (&quot;clt&quot; or &quot;hb&quot;).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        The computed p-values.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        If the method is not in the valid p-values methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_pvalues_method</span>
    <span class="n">p_values</span> <span class="o">=</span> <span class="n">RiskController</span><span class="o">.</span><span class="n">_valid_pvalues_method</span><span class="p">[</span><span class="n">method</span><span class="p">](</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span>
    <span class="p">)</span>
    <span class="n">p_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController._control_fwer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_control_fwer</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_control_fwer</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Control the family-wise error rate (FWER).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p_values</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The p-values with shape (n_params,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delta</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired error rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to use for FWER control ("standard" or "sgt").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted indices of valid hypotheses.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Warns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/exceptions.html#UserWarning">UserWarning</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no valid hypotheses are found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_control_fwer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">p_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control the family-wise error rate (FWER).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p_values : np.ndarray</span>
<span class="sd">        The p-values with shape (n_params,).</span>
<span class="sd">    delta : float</span>
<span class="sd">        The desired error rate.</span>
<span class="sd">    method : str</span>
<span class="sd">        The method to use for FWER control (&quot;standard&quot; or &quot;sgt&quot;).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        The sorted indices of valid hypotheses.</span>

<span class="sd">    Warns</span>
<span class="sd">    -----</span>
<span class="sd">    UserWarning</span>
<span class="sd">        If no valid hypotheses are found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="n">RiskController</span><span class="o">.</span><span class="n">_valid_fwer_method</span><span class="p">[</span><span class="n">method</span><span class="p">](</span>
        <span class="n">p_values</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;param_shape&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_shape</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No valid hypotheses.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController.test" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">test</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Test all hypotheses and identify valid lambda values that control the
risk and family-wise error rate. The procedure is as follows:</p>
<ol>
<li>Estimate p-values for each lambda (with
<a class="autorefs autorefs-internal" title="_estimate_pvalues" href="#risk_control.RiskController._estimate_pvalues"><code>_estimate_pvalues</code></a>
method).</li>
<li>Control the family-wise error rate (with
<a class="autorefs autorefs-internal" title="_control_fwer" href="#risk_control.RiskController._control_fwer"><code>_control_fwer</code></a> method).</li>
<li>Store the valid lambda values (<code>valid_lambdas</code>)
and their corresponding risks (<code>valid_risks</code>).</li>
</ol>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test all hypotheses and identify valid lambda values that control the</span>
<span class="sd">    risk and family-wise error rate. The procedure is as follows:</span>

<span class="sd">    1. Estimate p-values for each lambda (with</span>
<span class="sd">    [`_estimate_pvalues`][risk_control.RiskController._estimate_pvalues]</span>
<span class="sd">    method).</span>
<span class="sd">    2. Control the family-wise error rate (with</span>
<span class="sd">    [`_control_fwer`][risk_control.RiskController._control_fwer] method).</span>
<span class="sd">    3. Store the valid lambda values (`valid_lambdas`)</span>
<span class="sd">    and their corresponding risks (`valid_risks`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_pvalues</span><span class="p">(</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.values&quot;</span><span class="p">]),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span><span class="p">[</span><span class="n">name_</span><span class="p">],</span>
            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pvalue_method</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cr_specific_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_fwer</span><span class="p">(</span>
            <span class="n">p_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]),</span>
            <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwer_method</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr_specific_results</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;valid_lambdas&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">],</span>
                <span class="s2">&quot;valid_risks&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">],</span>
                <span class="s2">&quot;p_values&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr_specific_results</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;valid_lambdas&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;valid_risks&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;p_values&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">],</span>
            <span class="p">}</span>

    <span class="n">p_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.p_value&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="p">)</span>
    <span class="n">p_values</span> <span class="o">=</span> <span class="n">p_values</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;risks.AGG.p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_values</span>

    <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_fwer</span><span class="p">(</span>
        <span class="n">p_values</span><span class="o">=</span><span class="n">p_values</span><span class="p">,</span>
        <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwer_method</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_solution</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_solution</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr_results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;risks.</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="s2">.mean&quot;</span><span class="p">][</span><span class="n">indexes</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController.control" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">control</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">control</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Control the risk based on the specified method. The procedure is as follows:</p>
<ol>
<li>Check if a solution exists (<code>has_solution</code>).</li>
<li>If a solution exists, select the optimal lambda value (<code>l_star</code>) and
  corresponding risk (<code>r_star</code>) based on the control method.</li>
<li>Set the parameters of the decision model to the optimal lambda value.</li>
</ol>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/exceptions.html#ValueError">ValueError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no solution is found for risk control.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control the risk based on the specified method. The procedure is as follows:</span>

<span class="sd">    1. Check if a solution exists (`has_solution`).</span>
<span class="sd">    2. If a solution exists, select the optimal lambda value (`l_star`) and</span>
<span class="sd">      corresponding risk (`r_star`) based on the control method.</span>
<span class="sd">    3. Set the parameters of the decision model to the optimal lambda value.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If no solution is found for risk control.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_solution</span><span class="p">:</span>
        <span class="c1"># raise ValueError(&quot;No solution found for risk control.&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">RiskController</span><span class="o">.</span><span class="n">_valid_control_method</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">control_method</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_lambdas</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name_</span><span class="p">:</span> <span class="n">valid_risks_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">valid_risks_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_risks</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController.fit" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fit</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fit the decision model on the input data, i.e.:</p>
<ol>
<li>Evaluate the decision model on the calibration data.</li>
<li>Compute the p-values for the risk control.</li>
<li>Find the valid lambdas for the risk control.</li>
<li>Find the optimal lambda for the risk control.</li>
</ol>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/reference/expressions.html#dict">dict</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments to pass to the <code>evaluate</code> method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>self</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="RiskController (risk_control.RiskController)" href="#risk_control.RiskController">RiskController</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fitted risk control model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit the decision model on the input data, i.e.:</span>

<span class="sd">    1. Evaluate the decision model on the calibration data.</span>
<span class="sd">    2. Compute the p-values for the risk control.</span>
<span class="sd">    3. Find the valid lambdas for the risk control.</span>
<span class="sd">    4. Find the optimal lambda for the risk control.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : np.ndarray</span>
<span class="sd">        The input features.</span>
<span class="sd">    y : np.ndarray</span>
<span class="sd">        The target labels.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Additional keyword arguments to pass to the `evaluate` method.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self : RiskController</span>
<span class="sd">        The fitted risk control model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController.predict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">predict</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Make predictions on the input data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The predicted labels.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make predictions on the input data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : np.ndarray</span>
<span class="sd">        The input features.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        The predicted labels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="risk_control.RiskController.summary" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">summary</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">summary</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Print a summary of the risk control results.</p>


            <details class="quote">
              <summary>Source code in <code>risk_control/risk_control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a summary of the risk control results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== SUMMARY ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p(risk&lt;=alpha) &gt;= 1-delta&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1-delta: </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== risks ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name_</span><span class="p">,</span> <span class="n">risk_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">risks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">r_star</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">risk_</span><span class="o">.</span><span class="n">convert_to_performance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_star</span><span class="p">[</span><span class="n">name_</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_star</span>
            <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">risk_</span><span class="o">.</span><span class="n">convert_to_performance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_risks</span><span class="p">[</span><span class="n">name_</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="se">\t</span><span class="s2">| optimal: </span><span class="si">{</span><span class="n">r_star</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\t</span><span class="s2">| alpha: </span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== params ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">l_star</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span><span class="p">[</span><span class="n">name_</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_star</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_</span><span class="si">}</span><span class="se">\t</span><span class="s2">| optimal: </span><span class="si">{</span><span class="n">l_star</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../.." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Home
              </div>
            </div>
          </a>
        
        
          
          <a href="../decision/base/" class="md-footer__link md-footer__link--next" aria-label="Next: Base Module">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Base Module
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "navigation.footer", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>